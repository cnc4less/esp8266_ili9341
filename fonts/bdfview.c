
/**
 @file bdffont2c.c

 @brief BDF C code test/preview tool
 Displays fonts generated by bdffont2c BDF to C code converter
 BDF = Glyph Bitmap Distribution Format
 The code handles fixed, proportional and bounding box format fonts
 @see http://en.wikipedia.org/wiki/Glyph_Bitmap_Distribution_Format

 @par Copyright &copy; 2015 Mike Gore, GPL License
 @par You are free to use this code under the terms of GPL
   please retain a copy of this notice in any code you use it in.

This is free software: you can redistribute it and/or modify it under the
terms of the GNU General Public License as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.

This software is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/



/**
* BDF = Glyph Bitmap Distribution Format 
* See: http://en.wikipedia.org/wiki/Glyph_Bitmap_Distribution_Format
*/

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <limits.h>
#include <errno.h>
#include <stdint.h>


#include "font.h"
#include "bdffontutil.h"

#define FONTINFO
#define FONTSPECS
#include "fonts.h"


int main(int argc, char *argv[])
{
	char *ptr;
	int i;
	int preview = 1;
	int fontind = 0;
	int numfonts = 0;
	int table = 0;
	int bits = 0;
	int info = 0;
	int header = 0;
	int ccode = 0;

	_font *p;

	for(numfonts=0;allfonts[numfonts] != NULL;++numfonts)
		;

	printf("/* We have (%d) fonts */\n",numfonts);
	for(i=1;i<argc;++i)
	{
		ptr = argv[i];
		if(*ptr == '-')
		{
			++ptr;
			// Table
			if(*ptr == 't')
			{
				table = 1;
				continue;
			}
			// Bits
			if(*ptr == 'b')
			{
				bits = 1;
				continue;
			}

			// C Code
			if(*ptr == 'c')
			{
				ccode = 1;
				continue;
			}

			// Header
			if(*ptr == 'h')
			{
				header = 1;
				continue;
			}

			// Info
			if(*ptr == 'h')
			{
				info = 1;
				continue;
			}

			// Preview mode
			if(*ptr == 'p')
			{
				++ptr;
				if(*ptr)
				{
					preview = atoi(ptr);
				}
				else
				{
					preview = atoi(argv[++i]);
				}
				continue;
			}
			// Font Index
			if(*ptr == 'n')
			{
				++ptr;
				if(*ptr)
				{
					fontind = atoi(ptr);
				}
				else
				{
					fontind = atoi(argv[++i]);
				}
				continue;
			}
		}
	}
	if(fontind >= numfonts)
	{
		fprintf(stderr, "font index >= %d\n", numfonts);
		exit(1);

	}
	p = allfonts[fontind];

    if(header)
		FontHeaderInfo( stdout, p, argv[0], NULL);

    if(info)
		WriteFontInfo( stdout, p);

    if(ccode)
		Convert_Font2c(stdout, p);

    if(bits)
		WriteFontBits ( stdout, p);

    if(table)
		WriteFontTable ( stdout, p);

    if(preview)
		WriteFontBitsPreview(stdout, p,preview);

	return(0);
}
